# If you come from bash you might have to change your $PATH.
# export PATH=$HOME/bin:$HOME/.local/bin:/usr/local/bin:$PATH

# Path to your Oh My Zsh installation.
autoload -Uz compinit && compinit

# export ZSH="$HOME/.oh-my-zsh"
export CASE_SENSITIVE="false"
{{ if eq .chezmoi.os "darwin" -}}
export SSH_AUTH_SOCK="$HOME/.bitwarden-ssh-agent.sock"
{{ end -}}



# FPATH=$(brew --prefix)/share/zsh-completions:$FPATH
# autoload -Uz compinit
# compinit




# User configuration

# export MANPATH="/usr/local/man:$MANPATH"

# You may need to manually set your language environment
# export LANG=en_US.UTF-8

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR='vim'
else
  export EDITOR='code'
fi

# Compilation flags
# export ARCHFLAGS="-arch $(uname -m)"

# Set personal aliases, overriding those provided by Oh My Zsh libs,
# plugins, and themes. Aliases can be placed here, though Oh My Zsh
# users are encouraged to define aliases within a top-level file in
# the $ZSH_CUSTOM folder, with .zsh extension. Examples:
# - $ZSH_CUSTOM/aliases.zsh
# - $ZSH_CUSTOM/macos.zsh
# For a full list of active aliases, run `alias`.
#
# Example aliases
alias zshconfig="code \"$HOME/.zshrc\""
alias espansoconfig="code \"$HOME/Library/Application Support/espanso\""

extract () {
  if [ -f $1 ] ; then
    case $1 in
      *.tar.bz2)   tar xjf $1     ;;
      *.tar.gz)    tar xzf $1     ;;
      *.bz2)       bunzip2 $1     ;;
      *.rar)       unrar e $1     ;;
      *.gz)        gunzip $1      ;;
      *.tar)       tar xf $1      ;;
      *.tbz2)      tar xjf $1     ;;
      *.tgz)       tar xzf $1     ;;
      *.zip)       unzip $1       ;;
      *.Z)         uncompress $1  ;;
      *.7z)        7z x $1        ;;
      *)     echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
      echo "'$1' is not a valid file"
    fi
}

export PATH=$PATH:$HOME/.local/bin

refresh_github_token() {
  if ! command -v gh >/dev/null 2>&1; then
    echo "GitHub CLI (gh) is not installed."
    return 1
  fi

  if ! gh auth status >/dev/null 2>&1; then
    echo "No active GitHub CLI authentication session found."
    return 2
  fi

  local env_file="$HOME/.local/env/$1"
  if [ ! -f "$env_file" ]; then
    echo "Environment file '$env_file' not found."
    return 3
  fi

  local new_token
  new_token=$(gh auth token 2>/dev/null)
  if [ -z "$new_token" ]; then
    echo "Failed to retrieve GitHub token."
    return 4
  fi

  local var_name="${2:-GITHUB_TOKEN}"
  sed -i.bak -E "s|^(${var_name}=).*|\1$new_token|" "$env_file"
  echo "$var_name updated in $env_file"

}

# source /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh


## PATH SETTINGS
# Add Go binaries to PATH
export PATH="$PATH:$HOME/go/bin"

{{ if eq .chezmoi.os "darwin" -}}
export JAVA_HOME=$(/usr/libexec/java_home)
{{ end -}}
# Add pnpm to PATH
{{ if eq .chezmoi.os "darwin" -}}
export PNPM_HOME="$HOME/Library/pnpm"
{{ else -}}
export PNPM_HOME="$HOME/.local/share/pnpm"
{{ end -}}
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac
export PATH="$HOME/.local/share/pnpm:$PATH"
[ -d "$HOME/.local/bin" ] &&  export PATH="$HOME/.local/bin:$PATH"



export CARAPACE_BRIDGES='zsh,fish,bash,inshellisense' # optional
export CARAPACE_MATCH=1
# zstyle ':completion:*' format $'\e[2;37mCompleting %d\e[m'

if [ -z "$CLAUDECODE" ]; then
  [ -z "$DISABLE_CARAPACE" ] && [ "$(command -v carapace)" ] && source <(carapace _carapace zsh)
  # [ -z "$DISABLE_FZF" ] && [ "$(command -v fzf)" ] && source <(fzf --zsh)
  # [ -z "$DISABLE_TV" ] && [ "$(command -v tv)" ] && eval "$(tv init zsh)"
  [ -z "$DISABLE_STARSHIP" ] && [ "$(command -v starship)" ] && eval "$(starship init zsh)"
  # [ -z "$DISABLE_MCFLY" ] && [ "$(command -v mcfly)" ] && eval "$(mcfly init zsh)"
  [ -z "$DISABLE_ATUIN" ] && [ "$(command -v atuin)" ] && eval "$(atuin init zsh)"
  [ -z "$DISABLE_ZOXIDE" ] && [ "$(command -v zoxide)" ] && eval "$(zoxide init zsh --cmd cd)"
fi

{{ if eq .chezmoi.os "darwin" -}}
export PATH="$HOME/.config/herd-lite/bin:$PATH"
export PHP_INI_SCAN_DIR="$HOME/.config/herd-lite/bin:$PHP_INI_SCAN_DIR"
{{ end -}}

remove_node_modules() {
  echo "Searching for node_modules directories..."
  find . -name "node_modules" -type d -prune -print -exec rm -rf '{}' \;
}

remove_venvs() {
  echo "Searching for .venv directories..."
  find . -name ".venv" -type d -prune -print -exec rm -rf '{}' \;
}

curl_harder() {
  local count=0;
  until curl "$@" -O --retry 999 --retry-max-time 0 -C -
  do
    ((count++))
    echo "Reattempting download...${count}"
    sleep 1
  done
}

{{ if eq .chezmoi.os "darwin" -}}
export PATH="/opt/homebrew/opt/helm@3/bin:$PATH"
{{ end -}}
