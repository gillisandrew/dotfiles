## .zshrc: interactive shell config
# Runs for interactive shells only.
# Good: prompt/theme, aliases, functions, completions, keybindings.
# Avoid: PATH/toolchain exports (keep those in .zprofile).

[[ -o interactive ]] || return

. "$HOME/.local/bin/dotfiles-env"

autoload -Uz compinit
if [[ -f ~/.zcompdump && $(date +'%j') == $(stat -f '%Sm' -t '%j' ~/.zcompdump 2>/dev/null) ]]; then
  compinit -C  # use cached dump (skips security check + regeneration)
else
  compinit     # full rebuild
fi

# History
HISTSIZE=10000
SAVEHIST=10000
HISTFILE="$HOME/.zsh_history"
mkdir -p "$(dirname "$HISTFILE")"
setopt HIST_FCNTL_LOCK HIST_IGNORE_DUPS HIST_IGNORE_SPACE SHARE_HISTORY
setopt NO_APPEND_HISTORY NO_EXTENDED_HISTORY NO_HIST_EXPIRE_DUPS_FIRST
setopt NO_HIST_FIND_NO_DUPS NO_HIST_IGNORE_ALL_DUPS NO_HIST_SAVE_NO_DUPS

if [ "$DOTFILES_OS" = "macos" ]; then
  _brew_prefix="/opt/homebrew"
elif [ "$DOTFILES_OS" = "linux" ]; then
  _brew_prefix="/home/linuxbrew/.linuxbrew"
fi
if [ -n "$_brew_prefix" ]; then
  [ -f "$_brew_prefix/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ] && source "$_brew_prefix/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  [ -f "$_brew_prefix/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ] && source "$_brew_prefix/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
fi
unset _brew_prefix

ZSH_AUTOSUGGEST_STRATEGY=(history)
ZSH_HIGHLIGHT_HIGHLIGHTERS=(main)

{{ template "rc-common" "zsh" }}
